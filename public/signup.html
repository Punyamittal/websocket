<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Sign up - SecureDrop</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <!-- auto-redirect if already logged in -->
  <script>
  (async function(){
    try{
      const r = await fetch('/api/whoami', { credentials: 'same-origin' });
      if (r.ok) { window.location.href = '/dashboard.html'; }
    }catch(e){}
  })();
  </script>

  <main class="card">
    <h2>Create account</h2>
    <form method="POST" action="/signup" class="form" onsubmit="return validate()">
      <label>Username
        <input name="username" id="username" required />
      </label>
      <label>Password
        <input name="password" id="password" type="password" required />
      </label>
      <label>Confirm password
        <input name="password2" id="password2" type="password" required />
      </label>
      <div class="form-row">
        <button class="btn primary" type="submit">Sign up</button>
        <a class="link" href="/login.html">Already have an account?</a>
      </div>
    </form>
    <p id="err" class="error" style="display:none"></p>
  </main>

<script>
function validate(){
  const p1 = document.getElementById('password').value;
  const p2 = document.getElementById('password2').value;
  if(p1 !== p2){
    const e = document.getElementById('err');
    e.style.display='block'; e.innerText='Passwords do not match';
    return false;
  }
  return true;
}
</script>
</body>
</html>
