<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Login - SecureDrop</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <!-- auto-redirect if already logged in -->
  <script>
  (async function(){
    try{
      const r = await fetch('/api/whoami', { credentials: 'same-origin' });
      if (r.ok) { window.location.href = '/dashboard.html'; }
    }catch(e){}
  })();
  </script>

  <main class="card">
    <h2>Login</h2>
    <div id="error-message" style="display:none; color: red; background: #fee; padding: 10px; border-radius: 4px; margin-bottom: 15px;"></div>
    <form method="POST" action="/login" class="form">
      <label>Username
        <input name="username" required autocomplete="username" />
      </label>
      <label>Password
        <input name="password" type="password" required autocomplete="current-password" />
      </label>
      <div class="form-row">
        <button class="btn primary" type="submit">Login</button>
        <a class="link" href="/signup.html">Create account</a>
      </div>
    </form>
    <p class="muted small">After login you'll be redirected to the dashboard.</p>
  </main>
  <script>
    // Display error message if present in URL
    const urlParams = new URLSearchParams(window.location.search);
    const error = urlParams.get('error');
    if (error) {
      const errorDiv = document.getElementById('error-message');
      errorDiv.textContent = error;
      errorDiv.style.display = 'block';
    }
  </script>
</body>
</html>
